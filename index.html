<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La Nostra Storia - Dal Bruco alla Farfalla</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-pink: #ff6b9d;
            --primary-blue: #4a9eff;
            --bg-gradient-start: #ffeef8;
            --bg-gradient-end: #e8f4ff;
            --shadow-soft: 0 20px 60px rgba(0, 0, 0, 0.15);
            --shadow-float: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow-x: hidden;
        }

        .storybook-container {
            max-width: 900px;
            width: 100%;
            background: white;
            border-radius: 30px;
            box-shadow: var(--shadow-soft);
            overflow: hidden;
            position: relative;
        }

        .header {
            background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 50%, #a1c4fd 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-family: 'Poppins', sans-serif;
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.95;
            position: relative;
            z-index: 1;
        }

        /* Music Player Styles */
        .music-player {
            margin-top: 20px;
            position: relative;
            z-index: 1;
        }

        .music-button {
            background: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.5);
            padding: 12px 30px;
            border-radius: 30px;
            color: white;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .music-button:hover {
            background: rgba(255, 255, 255, 0.4);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);
        }

        .music-button:active {
            transform: translateY(0);
        }

        #musicIcon {
            font-size: 1.3em;
            animation: musicPulse 2s ease-in-out infinite;
        }

        .music-button.playing #musicIcon {
            animation: musicSpin 3s linear infinite;
        }

        @keyframes musicPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        @keyframes musicSpin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .progress-container {
            padding: 20px 30px;
            background: linear-gradient(135deg, #ffeef8 0%, #e8f4ff 100%);
        }

        .progress-bar-bg {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-pink), var(--primary-blue));
            border-radius: 10px;
            transition: width 0.5s ease;
            box-shadow: 0 2px 8px rgba(255, 107, 157, 0.4);
            position: relative;
            overflow: visible;
        }

        /* Animated Caterpillars */
        .caterpillar {
            position: absolute;
            top: -18px;
            font-size: 2em;
            cursor: pointer;
            transition: transform 0.3s ease;
            animation: wiggle 3s ease-in-out infinite;
            user-select: none;
            z-index: 10;
        }

        .pink-caterpillar {
            right: 5%;
            filter: hue-rotate(320deg) saturate(1.5);
            animation-delay: 0s;
        }

        .blue-caterpillar {
            right: 20%;
            filter: hue-rotate(200deg) saturate(1.3);
            animation-delay: 1.5s;
        }

        .caterpillar:hover {
            transform: scale(1.2);
        }

        .caterpillar.jump {
            animation: jumpAnimation 0.6s ease;
        }

        @keyframes wiggle {
            0%, 100% {
                transform: translateY(0) rotate(0deg);
            }
            25% {
                transform: translateY(-3px) rotate(-5deg);
            }
            75% {
                transform: translateY(-3px) rotate(5deg);
            }
        }

        @keyframes jumpAnimation {
            0% {
                transform: translateY(0) scale(1);
            }
            30% {
                transform: translateY(-25px) scale(1.3) rotate(15deg);
            }
            50% {
                transform: translateY(-30px) scale(1.4) rotate(0deg);
            }
            70% {
                transform: translateY(-25px) scale(1.3) rotate(-15deg);
            }
            100% {
                transform: translateY(0) scale(1) rotate(0deg);
            }
        }

        .episode-counter {
            text-align: center;
            margin-top: 10px;
            font-weight: 600;
            color: #666;
            font-size: 0.95em;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .reset-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            font-size: 1.2em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .reset-button:hover {
            transform: translateY(-2px) scale(1.1);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.5);
        }

        .reset-button:active {
            transform: translateY(0) scale(1);
        }

        .content {
            padding: 40px 30px;
        }

        .episode {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .episode.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .month-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .month-date {
            font-size: 1.1em;
            color: #888;
            font-weight: 500;
            margin-bottom: 15px;
        }

        .episode-title {
            font-family: 'Poppins', sans-serif;
            font-size: 2em;
            color: #333;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .scene {
            margin: 30px 0;
            text-align: center;
        }

        .episode-image {
            max-width: 100%;
            width: 100%;
            max-height: 500px;
            object-fit: contain;
            height: auto;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }

        .episode-video {
            max-width: 100%;
            width: 100%;
            max-height: 500px;
            object-fit: contain;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }

        .story-text {
            font-size: 1.15em;
            line-height: 1.8;
            color: #555;
            text-align: justify;
            margin-top: 30px;
            padding: 0 10px;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            gap: 15px;
            margin-top: 40px;
            margin-bottom: 40px;
            padding: 0 10px 20px 10px;
        }

        .navigation button {
            flex: 1;
            padding: 15px 25px;
            font-size: 1em;
            font-weight: 600;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Poppins', sans-serif;
        }

        .btn-prev {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-next {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(240, 147, 251, 0.4);
        }

        .navigation button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }

        .navigation button:active:not(:disabled) {
            transform: translateY(0);
        }

        .navigation button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .episode-image {
                max-height: 400px;
            }

            .episode-video {
                max-height: 400px;
            }

            .navigation {
                margin-bottom: 60px;
                padding-bottom: 30px;
            }

            .header h1 {
                font-size: 2em;
            }

            .header p {
                font-size: 1em;
            }

            .episode-title {
                font-size: 1.5em;
            }

            .story-text {
                font-size: 1.05em;
                text-align: left;
            }

            .content {
                padding: 30px 20px;
            }

            .navigation button {
                padding: 12px 20px;
                font-size: 0.95em;
            }
        }

        @media (max-width: 480px) {
            .episode-image {
                max-height: 300px;
            }

            .episode-video {
                max-height: 300px;
            }

            .navigation {
                margin-bottom: 80px;
                padding-bottom: 40px;
            }

            body {
                padding: 10px;
            }

            .header {
                padding: 30px 20px;
            }

            .header h1 {
                font-size: 1.75em;
            }

            .content {
                padding: 25px 15px;
            }

            .episode-title {
                font-size: 1.3em;
            }

            .story-text {
                font-size: 1em;
            }
        }
    </style>
</head>
<body>
    <div class="storybook-container">
        <div class="header">
            <h1>ü¶ã La Nostra Storia ü¶ã</h1>
            <p>Dal Bruco alla Farfalla - 23 Nov 2024 ‚Üí 20 Dic 2025</p>
            
            <!-- Music Player -->
            <div class="music-player">
                <button id="musicToggle" class="music-button">
                    <span id="musicIcon">üéµ</span>
                    <span id="musicText">Riproduci Musica</span>
                </button>
                <audio id="backgroundMusic" loop>
                    <source src="background-music.mp3" type="audio/mpeg">
                    Il tuo browser non supporta l'audio.
                </audio>
            </div>
        </div>

        <div class="progress-container">
            <div class="progress-bar-bg">
                <div class="progress-bar" id="progressBar" style="width: 7.7%;">
                    <div class="caterpillar pink-caterpillar" id="pinkCaterpillar" onclick="jumpCaterpillar('pink')">üêõ</div>
                    <div class="caterpillar blue-caterpillar" id="blueCaterpillar" onclick="jumpCaterpillar('blue')">üêõ</div>
                </div>
            </div>
            <div class="episode-counter">
                <span id="episodeCounter">Episodio 1 di 13</span>
                <button id="resetBtn" class="reset-button" onclick="resetToStart()" title="Torna all'inizio">üè†</button>
            </div>
        </div>

        <div class="content">
            <!-- EPISODIO 1 -->
            <div class="episode active" data-episode="1">
                <div class="month-header">
                    <div class="month-date">23 Novembre 2024</div>
                    <h2 class="episode-title">Il Cinema e i Fazzoletti</h2>
                </div>
                <div class="scene">
                    <img src="episode_1.png" alt="Il Cinema e i Fazzoletti" class="episode-image" />
                </div>
                <div class="story-text">
                    "Andiamo a vedere 'il ragazzo dai pantaloni rosa' all'Uci Cinema di Lissone? Ore 19:40" - Quel sabato sera di novembre, due bruchi si ritrovarono davanti a uno schermo luminoso. Pop corn croccanti tra le zampe, sorrisi nervosi, e la promessa di fazzoletti per asciugare lacrime. Non sapevano ancora che quelle lacrime condivise sarebbero state solo l'inizio. Alla fine del film, lui le mand√≤ una canzone su Spotify. "Grazie Fabio, questa canzone adesso mi fa venire i brividi" rispose lei. I brividi dell'inizio.
                </div>
            </div>

            <!-- EPISODIO 2 -->
            <div class="episode" data-episode="2">
                <div class="month-header">
                    <div class="month-date">30 Novembre 2024</div>
                    <h2 class="episode-title">133 Messaggi in Un Giorno</h2>
                </div>
                <div class="scene">
                    <img src="episode_2.png" alt="133 Messaggi in Un Giorno" class="episode-image" />
                </div>
                <div class="story-text">
                    "Dormito poco, ma quel poco √® stato bello, dolce. Ti immagino." - 133 messaggi. Un record. Un giorno intero passato a scriversi, a condividersi, a immaginarsi. "Ti immagino che ti riempio di baci" scrisse lei. Parlavano di spiritualit√†, di Vipassana, di tantra, di crescita. "Ti ringrazio ogni tua esperienza fino ad oggi √® sempre stata affine a quello che sento ü§ç‚ù§Ô∏è". E poi: "Ogni volta che ti sento √® come se accendessi fuoco dentro di me" üî• Il fuoco era stato acceso.
                </div>
            </div>

            <!-- EPISODIO 3 -->
            <div class="episode" data-episode="3">
                <div class="month-header">
                    <div class="month-date">1 Dicembre 2024</div>
                    <h2 class="episode-title">In Una Dimensione Parallela</h2>
                </div>
                <div class="scene">
                    <img src="episode_3.png" alt="In Una Dimensione Parallela" class="episode-image" />
                </div>
                <div class="story-text">
                    "In una dimensione parallela sono stata abbracciata a te tutta la notte." - Parole che facevano male e bene insieme. Lei immaginava abbracci in altre dimensioni. "Quando mi parli di dimensione parallela, ora mi viene in mente Interstellar ancora e cosa combina il tempo" scrisse lui. Due bruchi separati dalla realt√†, ma uniti in qualche piega dell'universo. L'Amore vero non ha bisogno di essere toccato per esistere.
                </div>
            </div>

            <!-- EPISODIO 4 -->
            <div class="episode" data-episode="4">
                <div class="month-header">
                    <div class="month-date">10 Dicembre 2024</div>
                    <h2 class="episode-title">Adoro i Tuoi Audiolibri</h2>
                </div>
                <div class="scene">
                    <img src="episode_4.png" alt="Adoro i Tuoi Audiolibri" class="episode-image" />
                </div>
                <div class="story-text">
                    "Buongiorno Fabio, adoro i tuoi audiolibri, lo sai. S√¨, c'√® da raccontarsi, da parlare per ore." - Lui aveva iniziato a mandarle vocali lunghi. Pezzi di anima registrati con la sua voce. Lei li adorava, li ascoltava e riascoltava. "Sono contento che apprezzi queste mie parole" rispondeva lui. La voce portava con s√© timbri, pause, respiri. Ogni audio era un abbraccio sonoro, ogni ascolto era intimit√† rubata alla distanza.
                </div>
            </div>

            <!-- EPISODIO 5 -->
            <div class="episode" data-episode="5">
                <div class="month-header">
                    <div class="month-date">15 Dicembre 2024</div>
                    <h2 class="episode-title">Se la Mia Situazione Fosse Diversa</h2>
                </div>
                <div class="scene">
                    <img src="episode_5.png" alt="Se la Mia Situazione Fosse Diversa" class="episode-image" />
                </div>
                <div class="story-text">
                    "Questo messaggio √® stato eliminato." "Avevo scritto, poi ho cancellato." "Se la mia situazione fosse diversa saremmo gi√† finiti a letto. Ti avrei mangiato." - Quel giorno lei trov√≤ il coraggio di dire la verit√†. Parole cancellate e poi riscritte. "Quando sarai uscito dalla tua grotta se mi vorrai ci sar√≤" scrisse lei. Due bruchi con vite complesse, ma con sentimenti cristallini. L'attesa non era un ostacolo, ma parte del loro percorso.
                </div>
            </div>

            <!-- EPISODIO 6 -->
            <div class="episode" data-episode="6">
                <div class="month-header">
                    <div class="month-date">7 Gennaio 2025</div>
                    <h2 class="episode-title">Ti Immagino Mentre Dormi</h2>
                </div>
                <div class="scene">
                    <img src="episode_6.png" alt="Ti Immagino Mentre Dormi" class="episode-image" />
                </div>
                <div class="story-text">
                    "Ti immagino mentre dormi. Mi √® sempre piaciuto guardare le persone che dormono. Si vedono cose che da svegli non mostrano." - Lei amava guardare le persone dormire. C'√® qualcosa di puro in un volto che dorme. Lui parlava della rete di Wyrd e di Dagaz. "Sono pi√π convinto di farmi un secondo tatuaggio" scrisse. "Da quando ho aperto gli occhi mi √® rimasta sempre voglia...di te." La voglia stava diventando bisogno.
                </div>
            </div>

            <!-- EPISODIO 7 -->
            <div class="episode" data-episode="7">
                <div class="month-header">
                    <div class="month-date">14 Febbraio 2025</div>
                    <h2 class="episode-title">Buongiorno ‚òÄÔ∏è</h2>
                </div>
                <div class="scene">
                    <img src="episode_7.png" alt="Buongiorno" class="episode-image" />
                </div>
                <div class="story-text">
                    "Buongiorno Franci ‚òÄÔ∏è" - Ogni mattina iniziava cos√¨. Un sole, un saluto, una promessa di esserci. San Valentino arriv√≤, ma loro non ne avevano bisogno. "Ti amo. Dal primo giorno (e non ho bisogno di San Valentino per dimostrartelo)" aveva scritto lui. L'Amore vero non aspetta le date sul calendario. Si manifesta nel "buongiorno ‚òÄÔ∏è" quotidiano, nei messaggi all'alba, nei "come stai?" sinceri. Ogni giorno pu√≤ essere San Valentino quando ami davvero.
                </div>
            </div>

            <!-- EPISODIO 8 -->
            <div class="episode" data-episode="8">
                <div class="month-header">
                    <div class="month-date">15 Marzo 2025</div>
                    <h2 class="episode-title">Ricordami di Chiederti Una Cosa</h2>
                </div>
                <div class="scene">
                    <img src="episode_8.png" alt="Ricordami di Chiederti Una Cosa" class="episode-image" />
                </div>
                <div class="story-text">
                    "Quando saremo vis a vis, ricordami di chiederti una cosa" - La primavera port√≤ promesse di incontri. Ogni conversazione aveva le sue parentesi - "(quando ci vedremo)", "(ricordami di dirti)". Promesse in sospeso come regali incartati. Sapevano che quando si sarebbero guardati negli occhi senza schermo, avrebbero avuto mille cose da dirsi. E forse non avrebbero detto nulla. Solo si sarebbero abbracciati. E sarebbe bastato.
                </div>
            </div>

            <!-- EPISODIO 9 -->
            <div class="episode" data-episode="9">
                <div class="month-header">
                    <div class="month-date">20 Maggio 2025</div>
                    <h2 class="episode-title">Vedrai che Torner√≤</h2>
                </div>
                <div class="scene">
                    <img src="episode_9.png" alt="Vedrai che Torner√≤" class="episode-image" />
                </div>
                <div class="story-text">
                    "Vedrai che torner√≤, meglio di prima e meno di domani." - Questa frase divenne il loro mantra. "Meglio di prima" significava crescita continua. "Meno di domani" significava che il meglio doveva ancora venire. "Ogni giorno, ogni domani per me significa essere una persona migliore di ieri ed ogni volta che torner√≤ da te sar√† per donarti una versione pi√π bella del presente" le aveva scritto lui. Si stavano trasformando. Il bozzolo stava prendendo forma.
                </div>
            </div>

            <!-- EPISODIO 10 -->
            <div class="episode" data-episode="10">
                <div class="month-header">
                    <div class="month-date">21 Giugno 2025</div>
                    <h2 class="episode-title">La Luce Cerca Spazio</h2>
                </div>
                <div class="scene">
                    <img src="episode_10.png" alt="La Luce Cerca Spazio" class="episode-image" />
                </div>
                <div class="story-text">
                    Il 21 giugno, il giorno pi√π lungo dell'anno. La luce aveva trovato il suo spazio massimo. E anche loro avevano trovato il loro ritmo. "Come hai detto 'Vedrai che dopo la tempesta c'√® sempre il sole'... io ci credo. Non voglio essere la tempesta per te, ma solo la luce per giorni migliori" le aveva scritto lui. Erano diventati l'uno la luce dell'altro. Due bruchi che camminavano verso la luce, insieme.
                </div>
            </div>

            <!-- EPISODIO 11 -->
            <div class="episode" data-episode="11">
                <div class="month-header">
                    <div class="month-date">15 Ottobre 2025</div>
                    <h2 class="episode-title">Grazie</h2>
                </div>
                <div class="scene">
                    <img src="episode_11.png" alt="Grazie" class="episode-image" />
                </div>
                <div class="story-text">
                    "Buongiorno Fabio, grazie dei tuoi audio. Ho dormito finalmente pi√π del solito." - Ottobre li trov√≤ pi√π sereni. Lei aveva iniziato a dormire meglio. "Grazie" era diventata la parola pi√π ricorrente. Grazie per gli audio, grazie per la pazienza, grazie per esserci, grazie per aspettare, grazie per capire. Avevano capito che l'Amore vero √® fatto anche di riconoscere i doni che l'altro ci fa. Ogni "grazie" era un mattone della loro casa.
                </div>
            </div>

            <!-- EPISODIO 12 -->
            <div class="episode" data-episode="12">
                <div class="month-header">
                    <div class="month-date">5 Dicembre 2025</div>
                    <h2 class="episode-title">Questo Tuo Lato Non L'Ho Mai Visto</h2>
                </div>
                <div class="scene">
                    <img src="episode_12.png" alt="Questo Tuo Lato Non L'Ho Mai Visto" class="episode-image" />
                </div>
                <div class="story-text">
                    "Buongiorno Fabio. Questo tuo lato non l'ho mai visto, dov'√®?" - Dopo pi√π di un anno insieme, continuavano a scoprirsi. Ogni giorno lui mostrava un lato nuovo. Lei si meravigliava ancora, si innamorava di nuovo. "Come fai a sorprendermi ancora?" gli chiedeva. Le persone vere sono come libri infiniti - puoi leggerli tutta la vita e scoprire sempre nuove storie. Mancavano pochi giorni al momento perfetto. Al giorno della metamorfosi.
                </div>
            </div>

            <!-- EPISODIO 13 -->
            <div class="episode" data-episode="13">
                <div class="month-header">
                    <div class="month-date">20 Dicembre 2025</div>
                    <h2 class="episode-title">Buon Compleanno - La Metamorfosi ü¶ã</h2>
                </div>
                <div class="scene">
                    <img src="episode_13.png" alt="La Metamorfosi" class="episode-image" />
                </div>
                <div class="story-text">
                    20 dicembre 2025. Il suo compleanno. Ma anche qualcosa di pi√π grande. In quel momento speciale, mentre rileggevano insieme la loro storia, sentirono qualcosa cambiare. Il bozzolo si apr√¨. Non erano pi√π gli stessi bruchi nervosi del cinema di un anno prima. "Guarda" sussurr√≤ lui, indicando il cielo. Due farfalle volavano nel tramonto invernale. "Siamo noi" disse lei con gli occhi lucidi. "La storia dei bruchi √® finita. Ma la storia delle farfalle... sta solo iniziando." Si abbracciarono stretti. Un abbraccio che sapeva di trasformazione, di promesse mantenute, di futuro. "Buon compleanno, Amore mio" disse lui. "Buon primo giorno, farfalla mia" rispose lei. E volarono. Insieme. Per sempre. ‚àûü¶ã
                </div>
            </div>

            <div class="navigation">
                <button class="btn-prev" id="prevBtn" onclick="changeEpisode(-1)">‚Üê Precedente</button>
                <button class="btn-next" id="nextBtn" onclick="changeEpisode(1)">Successivo ‚Üí</button>
            </div>
        </div>
    </div>

    <script>
        let currentEpisode = 1;
        const totalEpisodes = 13;

        // Music Player Functionality
        const musicToggle = document.getElementById('musicToggle');
        const backgroundMusic = document.getElementById('backgroundMusic');
        const musicIcon = document.getElementById('musicIcon');
        const musicText = document.getElementById('musicText');
        let isPlaying = false;

        // Try to autoplay music on page load
        window.addEventListener('load', function() {
            // Set volume first
            backgroundMusic.volume = 0.2;
            
            // Attempt immediate autoplay
            const playPromise = backgroundMusic.play();
            
            if (playPromise !== undefined) {
                playPromise.then(() => {
                    musicIcon.textContent = 'üé∂';
                    musicText.textContent = 'Pausa Musica';
                    musicToggle.classList.add('playing');
                    isPlaying = true;
                }).catch(error => {
                    console.log('Autoplay bloccato dal browser');
                    // Try on ANY user interaction
                    const startMusic = () => {
                        backgroundMusic.play().then(() => {
                            musicIcon.textContent = 'üé∂';
                            musicText.textContent = 'Pausa Musica';
                            musicToggle.classList.add('playing');
                            isPlaying = true;
                        }).catch(e => console.log('Impossibile riprodurre'));
                        
                        // Remove all listeners after first successful play
                        document.removeEventListener('click', startMusic);
                        document.removeEventListener('touchstart', startMusic);
                        document.removeEventListener('scroll', startMusic);
                    };
                    
                    document.addEventListener('click', startMusic, { once: true });
                    document.addEventListener('touchstart', startMusic, { once: true });
                    document.addEventListener('scroll', startMusic, { once: true });
                });
            }
        });

        musicToggle.addEventListener('click', function() {
            if (isPlaying) {
                backgroundMusic.pause();
                musicIcon.textContent = 'üéµ';
                musicText.textContent = 'Riproduci Musica';
                musicToggle.classList.remove('playing');
                isPlaying = false;
            } else {
                backgroundMusic.play().then(() => {
                    musicIcon.textContent = 'üé∂';
                    musicText.textContent = 'Pausa Musica';
                    musicToggle.classList.add('playing');
                    isPlaying = true;
                }).catch(error => {
                    console.log('Errore riproduzione audio:', error);
                    alert('Non riesco a riprodurre la musica. Assicurati di aver caricato il file audio.');
                });
            }
        });

        function updateEpisode() {
            document.querySelectorAll('.episode').forEach(ep => {
                ep.classList.remove('active');
            });

            document.querySelector(`[data-episode="${currentEpisode}"]`).classList.add('active');

            document.getElementById('episodeCounter').textContent = `Episodio ${currentEpisode} di ${totalEpisodes}`;

            const progress = (currentEpisode / totalEpisodes) * 100;
            document.getElementById('progressBar').style.width = progress + '%';

            document.getElementById('prevBtn').disabled = currentEpisode === 1;
            document.getElementById('nextBtn').disabled = currentEpisode === totalEpisodes;

            // Scroll to top on episode change
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function changeEpisode(direction) {
            currentEpisode += direction;
            if (currentEpisode < 1) currentEpisode = 1;
            if (currentEpisode > totalEpisodes) currentEpisode = totalEpisodes;
            updateEpisode();
        }

        function resetToStart() {
            currentEpisode = 1;
            updateEpisode();
        }

        // Caterpillar jump animation
        function jumpCaterpillar(color) {
            const caterpillar = document.getElementById(color === 'pink' ? 'pinkCaterpillar' : 'blueCaterpillar');
            caterpillar.classList.add('jump');
            
            // Remove animation class after it completes
            setTimeout(() => {
                caterpillar.classList.remove('jump');
            }, 600);
        }

        // Initialize
        updateEpisode();

        // Keyboard navigation
        document.addEventListener('keydown', function(e) {
            if (e.key === 'ArrowLeft' && currentEpisode > 1) {
                changeEpisode(-1);
            } else if (e.key === 'ArrowRight' && currentEpisode < totalEpisodes) {
                changeEpisode(1);
            }
        });

        // Touch swipe support for mobile - ONLY horizontal
        let touchStartX = 0;
        let touchEndX = 0;
        let touchStartY = 0;
        let touchEndY = 0;

        document.addEventListener('touchstart', e => {
            touchStartX = e.changedTouches[0].screenX;
            touchStartY = e.changedTouches[0].screenY;
        });

        document.addEventListener('touchend', e => {
            touchEndX = e.changedTouches[0].screenX;
            touchEndY = e.changedTouches[0].screenY;
            handleSwipe();
        });

        function handleSwipe() {
            const diffX = touchEndX - touchStartX;
            const diffY = touchEndY - touchStartY;
            
            // Only trigger swipe if horizontal movement is greater than vertical
            // This prevents episode change when scrolling up/down
            if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 50) {
                if (diffX < 0 && currentEpisode < totalEpisodes) {
                    // Swipe left - next episode
                    changeEpisode(1);
                }
                if (diffX > 0 && currentEpisode > 1) {
                    // Swipe right - previous episode
                    changeEpisode(-1);
                }
            }
        }
    </script>
</body>
</html>
